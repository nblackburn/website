---
import config from '@app/config';
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import type { Page, GetStaticPaths } from 'astro';
import sortProjects from '@utilities/sortProjects';
import ProjectCard from '@components/projectCard.vue';
import FilterableListLayout from '@layouts/filterableList.astro';

interface Props {
    page: Page;
}

export const getStaticPaths = (async ({ paginate }) => {
    const projects = await getCollection('project');
    const sortedProjects = sortProjects(projects);
    const mappedProjects = sortedProjects.map((project) => {
        return {
            props: project
        };
    });

    return paginate(mappedProjects, { pageSize: config.pagination.limit });
}) satisfies GetStaticPaths;

const title = 'Projects';
const activePage = 'projects';
const baseURL = '/projects/tags';
const featuredTags = config.projects.featuredTags;
const subTitle = 'Some of the things i have worked on';

const { page } = Astro.props;
---

<FilterableListLayout
    title={title}
    subTitle={subTitle}
    activePage={activePage}
    featuredTags={featuredTags}
    baseURL={baseURL}
    page={page}
>
    {
        page.data.map(({ props }) => (
            <ProjectCard project={props}>
                <Image
                    src={props.data.thumbnail}
                    alt={props.data.title}
                    width={768}
                    height={200}
                    loading="eager"
                    format="webp"
                    slot="thumbnail"
                />
            </ProjectCard>
        ))
    }
</FilterableListLayout>
